<link rel="stylesheet" href="css/game.css" />

<body>
  <script>
    function runLevel(level, Display) {
      let display = new Display(document.body, level);
      let state = State.start(level);
      let ending = 1;
      let running = "yes";
      return new Promise((resolve) => {
        // function that handles the exp key press
        // this will change the value of running to make it possible to pause the game
        // and re run when esc is pressed gain
        const handleEsc = (event) => {
          if (event.key != "Escape") return;
          event.preventDefault();
          if (running == "no") {
            // changes running to yes and run animation frame
            running = "yes";
            runAnimation(frame);
          } else if (running == "yes") {
            // changes running to be pausing
            running = "pausing";
          } else {
            running = "yes";
          }
        };
        // add event listener for esc key
        window.addEventListener("keydown", handleEsc);

        // this gets called from handleEsc and will check the state of running
        // if its "pausing" it will change running to "no" and return false so we can stop the animation
        const frame = (time) => {
          if (running == "pausing") {
            running = "no";
            return false;
          }
          state = state.update(time, arrowKeys);
          display.syncState(state);
          if (state.status == "playing") {
            return true;
          } else if (ending > 0) {
            ending -= time;
            return true;
          } else {
            display.clear();
            resolve(state.status);
            window.removeEventListener("keydown", handleEsc);
            return false;
          }
        };

        runAnimation(frame);
      });

      // provide a way to unregister its handlers


    }

    runGame(GAME_LEVELS, DOMDisplay);
  </script>
</body>
